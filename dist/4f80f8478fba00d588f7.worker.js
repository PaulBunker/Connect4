!function(n){var t={};function r(e){if(t[e])return t[e].exports;var a=t[e]={i:e,l:!1,exports:{}};return n[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=n,r.c=t,r.d=function(n,t,e){r.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var a in n)r.d(e,a,function(t){return n[t]}.bind(null,a));return e},r.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r.p="",r(r.s=0)}([function(n,t,r){"use strict";function e(n){return function(n){if(Array.isArray(n)){for(var t=0,r=new Array(n.length);t<n.length;t++)r[t]=n[t];return r}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r.r(t);var a=function(n){var t,r=!1,e=0;return n.forEach(function(n){t!==n||null===n?(e=1,t=n):e+=1,4===e&&(r=t)}),r},o=function(n){var t;return n.forEach(function(n){var r=a(n);r&&(t=r)}),t},i=function(n){return function(n){var t;return n.forEach(function(n){var r=a(n);r&&(t=r)}),t}(n)||function(n){var t;return n[0].forEach(function(r,e){var o=a(n.map(function(n){return n[e]}));o&&(t=o)}),t}(n)||o(function(n){for(var t=[],r=n[0].length-4;r>=0;r--){for(var e=[],a=r,o=0;o<n.length&&(e.push(n[o][a]),!(++a>n[0].length-1));o++);t.push(e)}for(var i=1;i<n.length-3;i++){for(var l=[],u=i,s=0;s<n[0].length&&(l.push(n[u][s]),++u!==n.length);s++);t.push(l)}return t}(n))||o(function(n){for(var t=[],r=3;r<n.length;r++){for(var e=[],a=0,o=r;o>=0;o--)e.push(n[o][a]),a++;t.push(e)}for(var i=1;i<n[0].length-3;i++){for(var l=[],u=i,s=n.length-1;s>0&&(l.push(n[s][u]),!(++u>n[0].length-1));s--);t.push(l)}return t}(n))||function(n){var t;return-1!==(t=[]).concat.apply(t,e(n)).indexOf(null)&&null}(n)};function l(n){return function(n){if(Array.isArray(n)){for(var t=0,r=new Array(n.length);t<n.length;t++)r[t]=n[t];return r}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=function(n,t,r){var e,a=l(n),o=a[t];return-1!==o.indexOf(null)&&(o=o.map(function(n){return n||e?n:(e=!0,r)}),a[t]=o,a)};function s(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function h(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function f(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function c(n,t,r){return t&&f(n.prototype,t),r&&f(n,r),n}var y=function(n){switch(n){case"r":return"y";case"y":return"r";default:return!1}},v=function(){function n(t,r){h(this,n),this.row=t,this.col=r}return c(n,[{key:"hash",value:function(){return"".concat(this.row.toString(),",").concat(this.col.toString())}}]),n}(),d=function(){function n(t,r){h(this,n),this.board=t,this.player=r,this.plays=this.getLegalPlays(),this.winner=i(t)}return c(n,[{key:"getLegalPlays",value:function(){var n=[];return this.board.forEach(function(t,r){var e=t.indexOf(null);-1!==e&&n.push(new v(e,r))}),n}},{key:"isPlayer",value:function(n){return n===this.player}},{key:"hash",value:function(){return JSON.stringify(this.board)}}]),n}(),p=function(){function n(t,r,e){var a=this;h(this,n),this.play=r,this.state=e,this.n_plays=0,this.n_wins=0,this.parent=t,this.children=new Map,e.plays.forEach(function(n){a.children.set(n.hash(),{play:n,node:null})})}return c(n,[{key:"childNode",value:function(n){var t=this.children.get(n.hash());if(void 0===t)throw new Error("No such play!");if(null===t.node)throw new Error("Child is not expanded!");return t.node}},{key:"expand",value:function(t,r){if(!this.children.has(t.hash()))throw new Error("No such play!");var e=new n(this,t,r);return this.children.set(t.hash(),{play:t,node:e}),e}},{key:"allPlays",value:function(){var n=[],t=!0,r=!1,e=void 0;try{for(var a,o=this.children.values()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;n.push(i.play)}}catch(n){r=!0,e=n}finally{try{t||null==o.return||o.return()}finally{if(r)throw e}}return n}},{key:"unexpandedPlays",value:function(){var n=[],t=!0,r=!1,e=void 0;try{for(var a,o=this.children.values()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;null===i.node&&n.push(i.play)}}catch(n){r=!0,e=n}finally{try{t||null==o.return||o.return()}finally{if(r)throw e}}return n}},{key:"isFullyExpanded",value:function(){var n=!0,t=!1,r=void 0;try{for(var e,a=this.children.values()[Symbol.iterator]();!(n=(e=a.next()).done);n=!0){if(null===e.value.node)return!1}}catch(n){t=!0,r=n}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}return!0}},{key:"isLeaf",value:function(){return 0===this.children.size}},{key:"getUCB1",value:function(n){return this.n_wins/this.n_plays+Math.sqrt(n*Math.log(this.parent.n_plays)/this.n_plays)}}]),n}(),g=new(function(){function n(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;h(this,n),s(this,"getMove",function(n,r){var e=new d(n,r);return t.runSearch(e,1),t.bestPlay(e).col}),s(this,"nextState",function(n,t){var r=u(n.board,t.col,n.player),e=y(n.player);return new d(r,e)}),s(this,"backpropagate",function(n,t){for(;null!==n;){if(n.n_plays+=1,!1===t||n.state.isPlayer(y(t))){var r=!1===t?.5:1;n.n_wins+=r}n=n.parent}}),this.UCB1ExploreParam=r,this.nodes=new Map}return c(n,[{key:"newGame",value:function(){this.nodes=new Map}},{key:"makeNode",value:function(n){if(!this.nodes.has(n.hash())){var t=new p(null,null,n);this.nodes.set(n.hash(),t)}}},{key:"runSearch",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;this.makeNode(n);for(var r=Date.now()+1e3*t;Date.now()<r;){var e=this.select(n),a=e.state.winner;!1===e.isLeaf()&&null===a&&(e=this.expand(e),a=this.simulate(e)),this.backpropagate(e,a)}}},{key:"bestPlay",value:function(n){if(this.makeNode(n),!1===this.nodes.get(n.hash()).isFullyExpanded())throw new Error("Not enough information!");var t,r=this.nodes.get(n.hash()),e=r.allPlays(),a=-1/0,o=!0,i=!1,l=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var h=u.value,f=r.childNode(h);f.n_plays>a&&(t=h,a=f.n_plays)}}catch(n){i=!0,l=n}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}return t}},{key:"select",value:function(n){for(var t=this.nodes.get(n.hash());t.isFullyExpanded()&&!t.isLeaf();){var r=t.allPlays(),e=void 0,a=-1/0,o=!0,i=!1,l=void 0;try{for(var u,s=r[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var h=u.value,f=t.childNode(h).getUCB1(this.UCB1ExploreParam);f>a&&(e=h,a=f)}}catch(n){i=!0,l=n}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}t=t.childNode(e)}return t}},{key:"expand",value:function(n){var t=n.unexpandedPlays(),r=t[Math.floor(Math.random()*t.length)],e=this.nextState(n.state,r),a=e.plays,o=n.expand(r,e,a);return this.nodes.set(e.hash(),o),o}},{key:"simulate",value:function(n){for(var t=n.state,r=i(t.board);null===r;){var e=t.plays,a=e[Math.floor(Math.random()*e.length)];t=this.nextState(t,a),r=i(t.board)}return r}}]),n}());self.addEventListener("message",function(n){if(n.data){var t=n.data,r=t.board,e=t.player;self.postMessage(g.getMove(r,e))}})}]);